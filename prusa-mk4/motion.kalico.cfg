# Do not edit this file!
# You can override settings from this file by adding a section of the same name
# in printer.cfg or another file included from it after the base configuration.

[printer]
kinematics: cartesian
# include/marlin/Configuration_MK4.h L801
max_velocity: 300
max_z_velocity: 40
# include/marlin/Configuration_MK4.h L816
max_accel: 7000
max_z_accel: 200  # 750 in Buddy FW seems to be too high
# Jerk hwlimit is 10, but it is set at 8 in the slicer. A common SCV estimate
# is to use jerk / sqrt(2).
# Since Klipper outputs for PrusaSlicer and OrcaSlicer do not set jerk in the
# gcode output, the default config here limits to the approximate equivalent of
# a jerk of 8.
square_corner_velocity: 5.65
minimum_cruise_ratio: 0

[stepper_x]
step_pin: PD7
dir_pin: PD6
enable_pin: !PB9
full_steps_per_rotation: 400
microsteps: 8
rotation_distance: 32  # 400 * 8 / 100
endstop_pin: tmc2130_stepper_x:virtual_endstop
position_endstop: -3 # -1 in include/marlin/Configuration_MK4.h L1159
position_min: -3
position_max: 250
homing_speed: 64
homing_retract_dist: 0
use_sensorless_homing: true

[tmc2130 stepper_x]
cs_pin: PG15
spi_bus: spi3a
diag0_pin: ^!PG9
run_current: 0.55
sense_resistor: 0.22
driver_SGT: -64
interpolate: true
# The following is from lib/Marlin/Marlin/src/module/stepper/trinamic.cpp L126
# with values from lib/Marlin/Marlin/src/feature/tmc_util.h CHOPPER_PRUSAMK3_24V 
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 1
driver_HSTRT: 5
driver_IHOLDDELAY: 10
driver_TPOWERDOWN: 128
driver_PWM_FREQ: 1
driver_PWM_AUTOSCALE: False
driver_PWM_GRAD: 12
driver_PWM_AMPL: 22

[stepper_y]
step_pin: PD5
dir_pin: !PD4
enable_pin: !PB9
microsteps: 8
full_steps_per_rotation: 400
rotation_distance: 32  # 400 * 8 / 100
endstop_pin: tmc2130_stepper_y:virtual_endstop
position_endstop: -6 # include/marlin/Configuration_MK4.h L1160
position_min: -6
position_max: 210
homing_speed: 64
homing_retract_dist: 0
use_sensorless_homing: true

[tmc2130 stepper_y]
cs_pin: PB5
spi_bus: spi3a
diag0_pin: ^!PE13
run_current: 0.7
sense_resistor: 0.22
driver_SGT: -64
interpolate: true
# The following is from lib/Marlin/Marlin/src/module/stepper/trinamic.cpp L126
# with values from lib/Marlin/Marlin/src/feature/tmc_util.h CHOPPER_PRUSAMK3_24V 
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 1
driver_HSTRT: 5
driver_IHOLDDELAY: 10
driver_TPOWERDOWN: 128
driver_PWM_FREQ: 1
driver_PWM_AUTOSCALE: False
driver_PWM_GRAD: 13
driver_PWM_AMPL: 22

[stepper_z]
step_pin: PD3
dir_pin: PD2
enable_pin: !PB8
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_min: -2
position_max: 220
homing_speed: 6 # 32

# Match probe speed
homing_retract_speed: 5
homing_retract_dist: 2
second_homing_speed: 1  

[tmc2130 stepper_z]
cs_pin: PF15
spi_bus: spi3a
stealthchop_threshold: 999999 # include/marlin/Configuration_MK4_adv.h L1683
run_current: 0.6 # include/marlin/Configuration_MK4_adv.h L1586
sense_resistor: 0.22
diag0_pin: ^!PB4
interpolate: true
# The following is from lib/Marlin/Marlin/src/module/stepper/trinamic.cpp L126
# with values from lib/Marlin/Marlin/src/feature/tmc_util.h CHOPPER_PRUSAMK3_24V 
#driver_TBL: 1
#driver_TOFF: 3
#driver_HEND: 1
#driver_HSTRT: 5
#driver_IHOLDDELAY: 10
#driver_TPOWERDOWN: 128
#driver_PWM_FREQ: 1
#driver_PWM_AUTOSCALE: True
#driver_PWM_GRAD: 15
#driver_PWM_AMPL: 180

[force_move]
enable_force_move: True

[safe_z_home]
home_xy_position: 14, 3.5
#   A X, Y coordinate (e.g. 100, 100) where the Z homing should be
#   performed. This parameter must be provided.
speed: 60.0
#   Speed at which the toolhead is moved to the safe Z home
#   coordinate. The default is 50 mm/s
z_hop: 2.0
#   Distance (in mm) to lift the Z axis prior to homing. This is
#   applied to any homing command, even if it doesn't home the Z axis.
#   If the Z axis is already homed and the current Z position is less
#   than z_hop, then this will lift the head to a height of z_hop. If
#   the Z axis is not already homed the head is lifted by z_hop.
#   The default is to not implement Z hop.
z_hop_speed: 30.0
#   Speed (in mm/s) at which the Z axis is lifted prior to homing. The
#   default is 15 mm/s.
move_to_previous: False
#   When set to True, the X and Y axes are reset to their previous
#   positions after Z axis homing. The default is False.
#home_y_before_x: False
#  # If True, the Y axis will home first. The default is False.

[input_shaper]
shaper_freq_x: 50
shaper_type_x: mzv
shaper_freq_y: 40
shaper_type_y: mzv
